(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-699fc02f"],{"234c":function(e,t,a){"use strict";a("ae1e")},4335:function(e,t,a){"use strict";a("7e26")},46903:function(e,t,a){"use strict";a.r(t);var i=a("9ab4"),r=a("1b40"),s=a("b3ad"),l=a("f50c"),n=a("5f8a"),o=a("f70d"),c=a("f244"),d=a("6ddb");let f=class extends r.e{constructor(){super(...arguments),this.loading=!1,this.disabled=!1,this.formData={name:"",start_time:"",end_time:"",target_user_type:1,target_goods_type:1,condition_type:1,status:0,region:[{area_id:"",region_id:"100000",region_name:"全国统一运费",threshold:""}]},this.areaId="",this.rules={name:[{required:!0,message:"请输入活动名称",trigger:["blur"]}],start_time:[{required:!0,message:"选择活动时间",trigger:"blur"}],max_buy:[{required:!0,message:"请输入每单限制数量",trigger:"blur"}]}}handleShowDelivery(){this.areaId=Object(d.f)(),this.$refs.deliveryArea.show()}handleEdit(e){this.areaId=e,this.$refs.deliveryArea.show()}handleDelete(e){this.areaId=e;const t=this.formData.region.findIndex(t=>t.area_id==e);-1!=t&&this.formData.region.splice(t,1),this.$nextTick(()=>{this.$refs.deliveryArea.clearSelectArea()})}areaChange(e){const t=this.formData.region.findIndex(e=>e.area_id==this.areaId),a=e.map(e=>e.value).join(),i=e.map(e=>e.label).join("、");if(-1!=t)return this.formData.region[t].region_id=a,void(this.formData.region[t].region_name=i);this.formData.region.push({area_id:this.areaId,region_id:a,region_name:i,threshold:""})}handleInput(e,t){e<=0&&""!==e&&(this.formData[t]=1)}handleSave(){this.$refs.form.validate((e,t)=>{if(!e)return!1;(this.id?Object(c.d)(this.formData):Object(c.a)(this.formData)).then(()=>{this.$router.go(-1)})})}getDetail(){this.loading=!0,Object(c.c)({id:this.id}).then(e=>{this.formData=e,this.loading=!1})}created(){this.id=this.$route.query.id,this.disabled=Boolean(this.$route.query.disabled),this.id&&this.getDetail()}};f=Object(i.a)([Object(r.a)({components:{MaterialSelect:s.a,DeliveryArea:o.a,DatePicker:n.a,GoodsSelect:l.a}})],f);var h=f,p=(a("4335"),a("2877")),u=Object(p.a)(h,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"free-shipping-edit"},[a("div",{staticClass:"ls-card free-shipping-edit__header"},[a("el-page-header",{attrs:{content:e.id?e.disabled?"包邮活动详情":"编辑包邮活动":"新增包邮活动"},on:{back:function(t){return e.$router.go(-1)}}})],1),a("div",{staticClass:"free-shipping-content"},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.formData,"label-width":"120px",size:"small",rules:e.rules,disabled:e.disabled}},[a("div",{staticClass:"ls-card m-t-16"},[a("div",{staticClass:"nr weight-500 m-b-20"},[e._v("活动设置")]),a("el-form-item",{attrs:{label:"活动名称",prop:"name"}},[a("el-input",{staticClass:"ls-input",attrs:{disabled:2==e.formData.status,placeholder:"请输入活动名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"活动时间",prop:"start_time"}},[a("date-picker",{attrs:{disabled:0!=e.formData.status,type:"datetimerange","start-time":e.formData.start_time,"end-time":e.formData.end_time},on:{"update:startTime":function(t){return e.$set(e.formData,"start_time",t)},"update:start-time":function(t){return e.$set(e.formData,"start_time",t)},"update:endTime":function(t){return e.$set(e.formData,"end_time",t)},"update:end-time":function(t){return e.$set(e.formData,"end_time",t)}}}),a("div",{staticClass:"muted"},[e._v("活动开始和结束时间，可以手动提前结束活动")])],1)],1),a("div",{staticClass:"ls-card m-t-16"},[a("div",{staticClass:"nr weight-500 m-b-20"},[e._v("活动规则")]),a("el-form-item",{attrs:{label:"活动对象",required:""}},[a("el-radio-group",{attrs:{disabled:0!=e.formData.status},model:{value:e.formData.target_user_type,callback:function(t){e.$set(e.formData,"target_user_type",t)},expression:"formData.target_user_type"}},[a("el-radio",{attrs:{label:1}},[e._v("全部用户")])],1),a("div",{staticClass:"muted"},[e._v("全部用户都参与该场包邮活动")])],1),a("el-form-item",{attrs:{label:"活动对象",required:""}},[a("el-radio-group",{attrs:{disabled:0!=e.formData.status},model:{value:e.formData.target_goods_type,callback:function(t){e.$set(e.formData,"target_goods_type",t)},expression:"formData.target_goods_type"}},[a("el-radio",{attrs:{label:1}},[e._v("全部商品")])],1)],1),a("el-form-item",{attrs:{label:"活动规则",required:""}},[a("el-radio-group",{attrs:{disabled:0!=e.formData.status},model:{value:e.formData.condition_type,callback:function(t){e.$set(e.formData,"condition_type",t)},expression:"formData.condition_type"}},[a("el-radio",{attrs:{label:1}},[e._v("按订单实付金额包邮")]),a("el-radio",{attrs:{label:2}},[e._v("按购买件数包邮")])],1)],1),a("el-form-item",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formData.region,size:"mini"}},[a("el-table-column",{attrs:{label:"配送区域",prop:"region_name","min-width":"250"}}),a("el-table-column",{attrs:{"min-width":"150",label:1==e.formData.condition_type?"订单金额":"购买件数"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"flex"},[a("span",[e._v(" 满 ")]),a("el-input",{staticClass:"m-8",staticStyle:{width:"170px"},attrs:{type:"number",disabled:0!=e.formData.status},model:{value:t.row.threshold,callback:function(a){e.$set(t.row,"threshold",a)},expression:"scope.row.threshold"}},[a("template",{slot:"append"},[e._v(" "+e._s(1==e.formData.condition_type?"元":"件")+" ")])],2),a("span",[e._v(" 包邮 ")])],1)]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return t.$index>0?[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleEdit(t.row.area_id)}}},[e._v(" 编辑 ")]),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleDelete(t.row.area_id)}}},[e._v(" 删除 ")])]:void 0}}],null,!0)})],1)],1),a("el-form-item",[a("el-button",{attrs:{disabled:e.disabled||0!=e.formData.status,size:"small",type:"primary"},on:{click:e.handleShowDelivery}},[e._v(" +添加规则 ")])],1)],1)])],1),a("delivery-area",{ref:"deliveryArea",attrs:{"area-id":e.areaId,"default-region":e.formData.region},on:{change:e.areaChange}}),a("div",{staticClass:"free-shipping-edit__footer bg-white ls-fixed-footer"},[a("div",{staticClass:"btns row-center flex",staticStyle:{height:"100%"}},[a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary",disabled:e.disabled},on:{click:e.handleSave}},[e._v("保存")])],1)])],1)}),[],!1,null,"a3d2b840",null);t.default=u.exports},"5f8a":function(e,t,a){"use strict";var i=a("9ab4"),r=a("1b40");let s=class extends r.e{constructor(){super(...arguments),this.pickerValue=[],this.pickerOptions={shortcuts:[{text:"最近一周",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]}}changeDate(){const e=this.pickerValue?this.pickerValue:this.pickerValue=["",""];this.$emit("update:start-time",e[0]),this.$emit("update:end-time",e[1])}handleStartTime(e){!this.pickerValue&&(this.pickerValue=[]),this.$set(this.pickerValue,0,e)}handleEndTime(e){!this.pickerValue&&(this.pickerValue=[]),this.$set(this.pickerValue,1,e)}};Object(i.a)([Object(r.c)()],s.prototype,"startTime",void 0),Object(i.a)([Object(r.c)()],s.prototype,"endTime",void 0),Object(i.a)([Object(r.c)({default:"datetimerange"})],s.prototype,"type",void 0),Object(i.a)([Object(r.c)({default:!1})],s.prototype,"disabled",void 0),Object(i.a)([Object(r.f)("startTime",{immediate:!0})],s.prototype,"handleStartTime",null),Object(i.a)([Object(r.f)("endTime",{immediate:!0})],s.prototype,"handleEndTime",null),s=Object(i.a)([r.a],s);var l=s,n=a("2877"),o=Object(n.a)(l,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-date-picker",{attrs:{type:e.type,"picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"yyyy-MM-dd HH:mm:ss",disabled:e.disabled},on:{change:e.changeDate},model:{value:e.pickerValue,callback:function(t){e.pickerValue=t},expression:"pickerValue"}})}),[],!1,null,null,null);t.a=o.exports},"7e26":function(e,t,a){},ae1e:function(e,t,a){},dc03:function(e,t,a){},f244:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"d",(function(){return s})),a.d(t,"c",(function(){return l})),a.d(t,"e",(function(){return n})),a.d(t,"b",(function(){return o})),a.d(t,"f",(function(){return c})),a.d(t,"g",(function(){return d}));var i=a("f175");const r=e=>i.a.post("/free_shipping.free_shipping/add",e),s=e=>i.a.post("/free_shipping.free_shipping/edit",e),l=e=>i.a.get("/free_shipping.free_shipping/detail",{params:e}),n=e=>i.a.get("/free_shipping.free_shipping/lists",{params:e}),o=e=>i.a.post("/free_shipping.free_shipping/delete",e),c=e=>i.a.post("/free_shipping.free_shipping/start",e),d=e=>i.a.post("/free_shipping.free_shipping/end",e)},f70d:function(e,t,a){"use strict";a("caad");var i=a("9ab4"),r=a("0463"),s=a("1b40"),l=a("0a6d");let n=class extends s.e{constructor(){super(...arguments),this.filterMethod=(e,t)=>"select"==this.type?!(!t.select||t.areaId!=this.areaId):!t.select&&(!this.isSelectAll(t)&&(!e||-1!==t.label.indexOf(e)))}filterTextChange(e){this.$refs.tree.filter(e)}areaIdChange(){this.filter()}onSelect(e,t){this.selectChildren(e,!0),this.filter(),this.$emit("select")}onCancel(e,t){this.selectChildren(e,!1),this.filter(),this.$emit("cancel")}filter(){this.$refs.tree.filter()}selectChildren(e,t){const{data:a,childNodes:i}=e;if(!i.length)return a.areaId&&a.areaId!=this.areaId||(a.select=t),void(a.areaId=a.areaId?t?a.areaId:0:this.areaId);i.forEach(e=>{this.selectChildren(e,t)})}isSelectAll(e){return e.children?e.children.every(e=>this.isSelectAll(e)):e.select}mounted(){this.filter()}};Object(i.a)([Object(s.c)({default:()=>{}})],n.prototype,"option",void 0),Object(i.a)([Object(s.c)()],n.prototype,"type",void 0),Object(i.a)([Object(s.c)()],n.prototype,"filterText",void 0),Object(i.a)([Object(s.c)()],n.prototype,"areaId",void 0),Object(i.a)([Object(s.f)("filterText")],n.prototype,"filterTextChange",null),Object(i.a)([Object(s.f)("areaId")],n.prototype,"areaIdChange",null),n=Object(i.a)([Object(s.a)({components:{LsDialog:l.a}})],n);var o=n,c=(a("f76d"),a("2877")),d=Object(c.a)(o,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"area-panel"},[a("el-scrollbar",{staticClass:"ls-scrollbar",staticStyle:{height:"450px"}},[a("div",{staticClass:"area-tree"},[a("el-tree",{ref:"tree",attrs:{"node-key":"value",data:e.option,"icon-class":"el-icon-arrow-right","filter-node-method":e.filterMethod},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,r=t.data;return a("div",{staticClass:"flex flex-1"},[a("span",{staticClass:"flex-1"},[e._v(e._s(i.label))]),a("div",{staticClass:"flex-none m-r-10"},["select"==e.type?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.onCancel(i,r)}}},[e._v(" 取消 ")]):a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.onSelect(i,r)}}},[e._v(" 选择 ")])],1)])}}])})],1)])],1)}),[],!1,null,"394e7b7a",null).exports,f=a("6ddb");let h=class extends s.e{constructor(){super(...arguments),this.isFirst=!0,this.filterText="",this.areaLists=JSON.parse(JSON.stringify(r.a)),this.onConfirm=Object(f.h)(()=>{const e=this.getSelectArea(this.areaLists);this.$emit("change",e)})}defaultRegionChange(e){this.isFirst&&(this.isFirst=!1,e.forEach(e=>{this.setSelectArea(e,this.areaLists)}))}show(){var e;null===(e=this.$refs.dialog)||void 0===e||e.onTrigger()}onSelect(){this.$refs.panelSelect.filter()}onCancel(){this.$refs.panelAll.filter()}getSelectArea(e){const t=[];return e.forEach(e=>{const a=[];e.children&&e.children.forEach(e=>{const i=e.children.filter(e=>e.select&&e.areaId==this.areaId);e.children.length==i.length?a.push(e):t.push(...i)}),a.length==e.children.length?t.push(e):t.push(...a)}),t}clearSelectArea(e){e=e||this.areaLists;for(const t in e)e[t].select&&e[t].areaId==this.areaId&&(e[t].select=!1,e[t].areaId=0),e[t].children&&this.clearSelectArea(e[t].children)}setSelectArea(e,t){t.forEach(t=>{t.children&&t.children.forEach(a=>{a.children&&a.children.forEach(i=>{(e.region_id.includes(t.value)||e.region_id.includes(a.value)||e.region_id.includes(i.value))&&(i.select=!0,i.areaId=e.area_id)})})})}mounted(){}};Object(i.a)([Object(s.c)()],h.prototype,"areaId",void 0),Object(i.a)([Object(s.c)()],h.prototype,"defaultRegion",void 0),Object(i.a)([Object(s.f)("defaultRegion")],h.prototype,"defaultRegionChange",null),h=Object(i.a)([Object(s.a)({components:{AreaPanel:d,LsDialog:l.a}})],h);var p=h,u=(a("234c"),Object(c.a)(p,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"delivery-area"},[a("ls-dialog",{ref:"dialog",attrs:{title:"区域选择",width:"900px",top:"20vh"},on:{confirm:e.onConfirm}},[a("div",{staticClass:"area-content flex col-stretch"},[a("div",{staticClass:"area-content__left flex-1"},[a("div",{staticClass:"flex row-between area-title"},[a("div",{staticClass:"normal nr"},[e._v("地区选择")]),a("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",placeholder:"输入地区关键字"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),a("area-panel",{ref:"panelAll",attrs:{option:e.areaLists,"filter-text":e.filterText,"area-id":e.areaId},on:{select:e.onSelect}})],1),a("div",{staticClass:"area-content__center flex row-center"},[a("i",{staticClass:"el-icon-arrow-right font-size-30"})]),a("div",{staticClass:"area-content__right flex-1"},[a("div",{staticClass:"flex row-between area-title"},[a("div",{staticClass:"normal nr"},[e._v("已选择")])]),a("div",{staticClass:"select-area-list"},[a("area-panel",{ref:"panelSelect",attrs:{option:e.areaLists,"area-id":e.areaId,type:"select"},on:{cancel:e.onCancel}})],1)])])])],1)}),[],!1,null,"65fa6509",null));t.a=u.exports},f76d:function(e,t,a){"use strict";a("dc03")}}]);