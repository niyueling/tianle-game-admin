(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-01925534"],{"20b4":function(t,e,i){"use strict";i.r(e);var s=i("9ab4"),a=i("1b40"),n=i("469e"),r=i("6ddb"),l=i("3c50");let o=class extends a.e{constructor(){super(...arguments),this.outerVisible=!1,this.innerVisible=!1,this.threeVisible=!1,this.isSecondaryDev=!0,this.loading=!0,this.pager=new r.a,this.id=0,this.timer=0}getSystemUpgradeLists(){this.pager.request({callback:n.k}).catch(()=>{this.$message.error("数据请求失败，刷新重载")})}toPackage(t,e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{Object(n.j)({id:t,update_type:e}).then(t=>{6==e?window.open(t.line,"_blank"):window.location.href=t.line})},500)}systemUpgrade(){Object(n.i)({id:this.id,update_type:1}).then(t=>{this.getSystemUpgradeLists()}).finally(()=>{this.threeVisible=!1,this.innerVisible=!1,this.outerVisible=!1})}onOuterVisible(t){this.outerVisible=!0,this.id=t}NotSecondaryDev(){this.isSecondaryDev=!1,this.innerVisible=!0}SecondaryDev(){this.isSecondaryDev=!0,this.innerVisible=!0}confirmUpdate(){this.threeVisible=!0,this.systemUpgrade()}created(){this.getSystemUpgradeLists()}};o=Object(s.a)([Object(a.a)({components:{LsPagination:l.a}})],o);var c=o,d=(i("e7e9"),i("2877")),u=Object(d.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"system-update"},[i("div",{staticClass:"ls-card"},[i("el-alert",{staticClass:"xxl",attrs:{type:"info",closable:!1,"show-icon":""}},[i("template",{slot:"title"},[i("div",{staticClass:"iconSize"},[t._v("温馨提示：")]),i("div",{staticClass:"iconSize flex"},[t._v(" 1.版本更新需要逐个版本更新， "),i("div",{staticClass:"a-key"},[t._v("更新前请备份好系统和数据库，更新成功后需要强制刷新站点；")])]),i("div",{staticClass:"iconSize"},[t._v("2.系统没有做二次开发，可以直接选择在线更新功能；")]),i("div",{staticClass:"iconSize"},[t._v(" 3.系统已做二次开发，进行了功能修改，请谨慎选择在线更新功能，推荐以更新包的形式手动更新； ")]),i("div",{staticClass:"iconSize"},[t._v(" 4.由于更换新域名原因，1.3.1及以下版本，需修改server/app/adminapi/logic/settings/system/UpgradeLogic.php文件中的BASE_URL为https://server.likeshop.cn 否则系统更新列表会报错。 ")])])],2)],1),i("div",{staticClass:"ls-card m-t-16"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:!1,expression:"false"}],staticStyle:{width:"100%"},attrs:{data:t.pager.lists,size:"mini","header-cell-style":{background:"#f5f8ff"}}},[i("el-table-column",{attrs:{prop:"publish_time",label:"发布日期"}}),i("el-table-column",{attrs:{label:"版本号"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticClass:"flex"},[0==e.$index&&1==t.pager._page?i("el-tag",{attrs:{size:"small",type:"success",effect:"plain",round:""}},[t._v(" new")]):t._e(),i("div",{staticClass:"m-l-5"},[t._v(t._s(e.row.version_no))])],1),i("div",{},[t._v(" "+t._s(e.row.version_str)+" ")])]}}])}),i("el-table-column",{attrs:{prop:"",label:"版本内容"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._l(e.row.add,(function(e,s){return i("div",{},[t._v(" "+t._s(e)+" ")])})),t._l(e.row.optimize,(function(e,s){return i("div",{},[t._v(" "+t._s(e)+" ")])})),t._l(e.row.repair,(function(e,s){return i("div",{},[t._v(" "+t._s(e)+" ")])}))]}}])}),i("el-table-column",{attrs:{prop:"notice",label:"注意事项"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.notice,(function(e,s){return i("div",{key:s},[t._v(" "+t._s(e)+" ")])}))}}])}),i("el-table-column",{attrs:{label:"操作","min-width":"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticClass:"operation flex flex-wrap"},[1==e.row.able_update?i("el-button",{staticClass:"m-r-10",attrs:{slot:"trigger",type:"primary",size:"small"},on:{click:function(i){return t.onOuterVisible(e.row.id)}},slot:"trigger"},[t._v("一键更新 ")]):t._e(),e.row.integral_package_link?i("el-button",{staticClass:"m-r-10",attrs:{slot:"trigger",type:"",size:"small"},on:{click:function(i){return t.toPackage(e.row.id,6)}},slot:"trigger"},[t._v("下载完整安装包 ")]):t._e(),e.row.package_link?i("el-button",{staticClass:"m-r-10",attrs:{slot:"trigger",type:"",size:"small"},on:{click:function(i){return t.toPackage(e.row.id,2)}},slot:"trigger"},[t._v("下载服务端更新包")]):t._e(),e.row.pc_package_link?i("el-button",{staticClass:"m-r-10",attrs:{slot:"trigger",type:"",size:"small"},on:{click:function(i){return t.toPackage(e.row.id,3)}},slot:"trigger"},[t._v("下载pc端更新包")]):t._e(),e.row.uniapp_package_link?i("el-button",{staticClass:"m-r-10",attrs:{slot:"trigger",type:"",size:"small"},on:{click:function(i){return t.toPackage(e.row.id,4)}},slot:"trigger"},[t._v("下载uniapp更新包")]):t._e(),e.row.web_package_link?i("el-button",{attrs:{slot:"trigger",type:"",size:"small"},on:{click:function(i){return t.toPackage(e.row.id,5)}},slot:"trigger"},[t._v(" 下载后台前端更新包")]):t._e(),e.row.kefu_package_link?i("el-button",{attrs:{slot:"trigger",type:"",size:"small"},on:{click:function(i){return t.toPackage(e.row.id,8)}},slot:"trigger"},[t._v(" 下载客服更新包")]):t._e()],1)]}}])})],1),i("div",{staticClass:"flex row-right m-t-16 row-right"},[i("ls-pagination",{on:{change:function(e){return t.getSystemUpgradeLists()}},model:{value:t.pager,callback:function(e){t.pager=e},expression:"pager"}})],1)],1),i("el-dialog",{staticClass:"dialog",attrs:{title:"",visible:t.outerVisible,width:"30%",top:"40vh",center:""},on:{"update:visible":function(e){t.outerVisible=e}}},[i("el-dialog",{staticClass:"dialogTwo",attrs:{width:"30%",top:"40vh",visible:t.innerVisible,"append-to-body":"",center:""},on:{"update:visible":function(e){t.innerVisible=e}}},[i("el-dialog",{staticClass:"dialogThree",attrs:{width:"30%",top:"40vh",visible:t.threeVisible,"append-to-body":"",center:"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.threeVisible=e}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{height:"200px","text-align":"center"},attrs:{"element-loading-text":"切勿关闭窗口或刷新页面"}},[i("div",[t._v("系统更新中，更新完毕后会自行刷新页面")])])]),0==t.isSecondaryDev?i("div",{staticStyle:{height:"200px"}},[i("div",{staticStyle:{"text-align":"center"}},[t._v(" 一键更新导致的系统问题，欢迎前往社区反馈，请做好系统备份！ ")]),i("div",{staticClass:"btn-div flex-col",staticStyle:{width:"160px",margin:"auto"}},[i("el-button",{staticStyle:{"margin-top":"15px","margin-left":"0"},attrs:{type:"primary",size:"small"},on:{click:t.confirmUpdate}},[t._v("确定更新")]),i("el-button",{staticStyle:{"margin-top":"15px","margin-left":"0"},attrs:{size:"small"},on:{click:function(e){t.innerVisible=!1}}},[t._v(" 取消更新")])],1)]):t._e(),1==t.isSecondaryDev?i("div",{staticStyle:{height:"200px"}},[i("div",{staticStyle:{"text-align":"center"}},[i("div",[t._v("二次开发后请谨慎使用一键更新功能！")]),i("div",[t._v("二次开发后一键更新导致的系统问题，官方无法处理，请做好系统备份！")])]),i("div",{staticClass:"btn-div flex-col",staticStyle:{width:"160px",margin:"auto"}},[i("el-button",{staticStyle:{"margin-top":"15px","margin-left":"0"},attrs:{type:"primary",size:"small"},on:{click:t.confirmUpdate}},[t._v("确定更新")]),i("el-button",{staticStyle:{"margin-top":"15px","margin-left":"0"},attrs:{size:"small"},on:{click:function(e){t.innerVisible=!1}}},[t._v(" 下载更新包，手动更新")]),i("el-button",{staticStyle:{"margin-top":"15px","margin-left":"0"},attrs:{size:"small"},on:{click:function(e){t.innerVisible=!1}}},[t._v(" 取消更新")])],1)]):t._e()],1),i("div",{staticStyle:{height:"200px"}},[i("div",{staticStyle:{"text-align":"center"}},[t._v("系统是否进行二次开发")]),i("div",{staticClass:"flex-col"},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.NotSecondaryDev}},[t._v("未做二次开发，直接更新")]),i("el-button",{attrs:{size:"small"},on:{click:t.SecondaryDev}},[t._v("已做二次开发")]),i("el-button",{attrs:{size:"small"},on:{click:function(e){t.outerVisible=!1}}},[t._v("取消更新")])],1)])],1)],1)}),[],!1,null,"7c358134",null);e.default=u.exports},"469e":function(t,e,i){"use strict";i.d(e,"l",(function(){return a})),i.d(e,"h",(function(){return n})),i.d(e,"f",(function(){return r})),i.d(e,"a",(function(){return l})),i.d(e,"c",(function(){return o})),i.d(e,"d",(function(){return c})),i.d(e,"b",(function(){return d})),i.d(e,"e",(function(){return u})),i.d(e,"g",(function(){return p})),i.d(e,"k",(function(){return g})),i.d(e,"j",(function(){return v})),i.d(e,"i",(function(){return b}));var s=i("f175");const a=t=>s.a.get("/settings.system.log/lists",{params:t}),n=()=>s.a.post("/settings.system.cache/clear"),r=()=>s.a.get("/crontab.crontab/lists"),l=t=>s.a.post("/crontab.crontab/add",t),o=t=>s.a.get("/crontab.crontab/detail",{params:t}),c=t=>s.a.post("/crontab.crontab/edit",t),d=t=>s.a.post("/crontab.crontab/delete",t),u=t=>s.a.get("/crontab.crontab/expression",{params:t}),p=t=>s.a.post("/crontab.crontab/operate",t),g=t=>s.a.get("/settings.system.upgrade/lists",{params:t}),v=t=>s.a.post("/settings.system.upgrade/downloadPkg",t),b=t=>s.a.post("/settings.system.upgrade/upgrade",t)},6338:function(t,e,i){},e7e9:function(t,e,i){"use strict";i("6338")}}]);